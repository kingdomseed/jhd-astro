---
// Site header containing the logo, primary navigation and an
// accessible Download dropdown menu with platform links. The sticky
// behaviour is achieved through CSS defined in the global stylesheet.
import brandLogoUrl from "../assets/logo/logo.svg?url";
import { getLangFromUrl, useTranslations } from "../i18n/utils";
import { getRelativeLocaleUrl } from "astro:i18n";
import LanguagePicker from "./LanguagePicker.astro";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

function l(path: string) {
  return getRelativeLocaleUrl(lang, path);
}
---

<header class="header-nav">
  <div class="container row" style="justify-content: space-between">
    <a class="brand" href={l("/")} aria-label="Jason Holt Digital home">
      <img
        class="brand-logo"
        src={brandLogoUrl}
        alt="Jason Holt Digital"
        width="48"
        height="48"
        decoding="async"
        loading="lazy"
      />
      <strong>Jason Holt Digital</strong>
    </a>

    <!-- Desktop Navigation -->
    <nav id="siteNav" class="nav nav--desktop" aria-label="Primary">
      <a href={l("/")}
        ><i class="fa-slab fa-regular fa-house" aria-hidden="true"></i><span
          >{t("nav.home")}</span
        ></a
      >
      <a href={l("apps")}
        ><i class="fa-slab fa-regular fa-desktop" aria-hidden="true"></i><span
          >{t("nav.apps")}</span
        ></a
      >
      <a href={l("resources")}
        ><i class="fa-slab fa-regular fa-book-open" aria-hidden="true"></i><span
          >{t("nav.resources")}</span
        ></a
      >
      <a href={l("blog")}
        ><i class="fa-slab fa-regular fa-newspaper" aria-hidden="true"></i><span
          >{t("nav.blog")}</span
        ></a
      >
      <div class="desktop-lang-picker">
        <LanguagePicker />
      </div>
      <!-- Download call to action: dropdown menu with platform links -->
      <span class="cta-download-wrap">
        <button
          class="btn btn--secondary btn--compact cta-download"
          aria-haspopup="menu"
          aria-expanded="false"
          aria-controls="downloadMenu"
        >
          <span>{t("cta.get_app")}</span>
          <i class="fa-slab fa-regular fa-angle-down" aria-hidden="true"></i>
        </button>
        <div
          id="downloadMenu"
          class="menu"
          role="menu"
          aria-label="Choose a platform"
        >
          <a
            role="menuitem"
            href="https://apps.apple.com/us/app/mythic-gme-mobile/id6726999147"
            target="_blank"
            rel="noopener"
          >
            <i class="fa-brands fa-apple" aria-hidden="true"></i>
            {t("platform.apple")}
          </a>
          <a
            role="menuitem"
            href="https://play.google.com/store/apps/details?id=com.jasonholtdigital.mythicgme2e"
            target="_blank"
            rel="noopener"
          >
            <i class="fa-brands fa-google-play" aria-hidden="true"></i>
            {t("platform.google")}
          </a>
          <a
            role="menuitem"
            href="https://www.amazon.ca/Jason-Holt-Digital-LLC-Mythic/dp/B0DJBPF9L9"
            target="_blank"
            rel="noopener"
          >
            <i class="fa-brands fa-amazon" aria-hidden="true"></i>
            {t("platform.amazon")}
          </a>
          <a
            role="menuitem"
            href="https://apps.microsoft.com/detail/9n39b8hj3cdg"
            target="_blank"
            rel="noopener"
          >
            <i class="fa-brands fa-windows" aria-hidden="true"></i>
            {t("platform.microsoft")}
          </a>
          <a
            role="menuitem"
            href="https://jasonholtdigital.itch.io/mythic-gme-digital"
            target="_blank"
            rel="noopener"
          >
            <i class="fa-brands fa-itch-io" aria-hidden="true"></i>
            {t("platform.itch")}
          </a>
        </div>
      </span>
    </nav>

    <!-- Mobile Menu Toggle -->
    <button
      class="mobile-toggle"
      aria-label="Open navigation menu"
      aria-expanded="false"
      aria-controls="mobileNav"
      data-mobile-toggle
    >
      <span class="mobile-toggle-icons" aria-hidden="true">
        <i
          class="fa-slab fa-regular fa-bars mobile-toggle-icon mobile-toggle-icon--bars"
        ></i>
        <i
          class="fa-slab fa-regular fa-xmark mobile-toggle-icon mobile-toggle-icon--x"
        ></i>
      </span>
    </button>
  </div>

  <!-- Mobile Navigation Overlay -->
  <div class="mobile-overlay" data-mobile-overlay aria-hidden="true"></div>

  <!-- Mobile Navigation Menu -->
  <nav
    id="mobileNav"
    class="nav nav--mobile"
    aria-label="Mobile navigation"
    data-mobile-nav
  >
    <div class="nav-mobile-content">
      <header class="nav-mobile-header">
        <strong>{t("nav.mobile.nav")}</strong>
      </header>

      <div class="nav-mobile-links">
        <a href={l("/")}
          ><i class="fa-slab fa-regular fa-house" aria-hidden="true"></i><span
            >{t("nav.home")}</span
          ></a
        >
        <a href={l("apps")}
          ><i class="fa-slab fa-regular fa-desktop" aria-hidden="true"></i><span
            >{t("nav.apps")}</span
          ></a
        >
        <a href={l("resources")}
          ><i class="fa-slab fa-regular fa-book-open" aria-hidden="true"
          ></i><span>{t("nav.resources")}</span></a
        >
        <a href={l("blog")}
          ><i class="fa-slab fa-regular fa-newspaper" aria-hidden="true"
          ></i><span>{t("nav.blog")}</span></a
        >
        <div class="mobile-lang-picker" style="padding: 1rem 1.5rem;">
          <LanguagePicker />
        </div>
      </div>

      <div class="nav-mobile-cta">
        <div class="nav-mobile-section-title">{t("nav.mobile.download")}</div>
        <div class="nav-mobile-downloads">
          <a
            href="https://apps.apple.com/us/app/mythic-gme-mobile/id6726999147"
            target="_blank"
            rel="noopener"
          >
            <i class="fa-brands fa-apple" aria-hidden="true"></i>
            {t("platform.apple")}
          </a>
          <a
            href="https://play.google.com/store/apps/details?id=com.jasonholtdigital.mythicgme2e"
            target="_blank"
            rel="noopener"
          >
            <i class="fa-brands fa-google-play" aria-hidden="true"></i>
            {t("platform.google")}
          </a>
          <a
            href="https://www.amazon.ca/Jason-Holt-Digital-LLC-Mythic/dp/B0DJBPF9L9"
            target="_blank"
            rel="noopener"
          >
            <i class="fa-brands fa-amazon" aria-hidden="true"></i>
            {t("platform.amazon")}
          </a>
          <a
            href="https://apps.microsoft.com/detail/9n39b8hj3cdg"
            target="_blank"
            rel="noopener"
          >
            <i class="fa-brands fa-windows" aria-hidden="true"></i>
            {t("platform.microsoft")}
          </a>
          <a
            href="https://jasonholtdigital.itch.io/mythic-gme-digital"
            target="_blank"
            rel="noopener"
          >
            <i class="fa-brands fa-itch-io" aria-hidden="true"></i>
            {t("platform.itch")}
          </a>
        </div>
      </div>
    </div>
  </nav>
</header>
<script>
  import "../scripts/header-dropdown.ts";
  import "../scripts/header-mobile.ts";
  import "../scripts/header-sticky.ts";
  import "../scripts/skip-link-focus.ts";
  // Hoisted import: processed by Astro/Vite, supports TS and npm deps.
  // See: https://docs.astro.build/en/guides/client-side-scripts/#hoisted-scripts
</script>

<style>
  .desktop-lang-picker {
    display: flex;
    align-items: center;
    margin-left: 1rem;
    margin-right: 1rem;
  }
</style>
