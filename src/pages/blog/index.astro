---
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import HeadFonts from '../../components/HeadFonts.astro';
import PageHeader from '../../components/PageHeader.astro';
import { getCollection, type CollectionEntry } from 'astro:content';

type BlogEntry = CollectionEntry<'blog'>;

const posts = (await getCollection('blog'))
  .slice()
  .sort((a: BlogEntry, b: BlogEntry) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime());

const featuredEntry: BlogEntry | undefined = posts[0];
const moreEntries: BlogEntry[] = posts.slice(1);
const listEntries: BlogEntry[] = moreEntries.length > 0 ? moreEntries : posts;

const categories = [
  {
    name: 'Release Notes',
    description: 'Version highlights and detailed changelogs.',
    icon: 'fa-slab fa-regular fa-rocket',
    href: '#release-notes',
  },
  {
    name: 'Behind the Scenes',
    description: 'Design explorations and process breakdowns.',
    icon: 'fa-slab fa-regular fa-palette',
    href: '#behind-the-scenes',
  },
  {
    name: 'Guides',
    description: 'Play-tested tips and workflows for Mythic tools.',
    icon: 'fa-slab fa-regular fa-compass',
    href: '#guides',
  },
  {
    name: 'Community',
    description: 'Spotlights, interviews, and play reports.',
    icon: 'fa-slab fa-regular fa-users',
    href: '#community',
  },
];

const formatDate = (value: string) =>
  new Intl.DateTimeFormat('en-US', {
    month: 'short',
    day: 'numeric',
    year: 'numeric',
  }).format(new Date(value));
---
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <HeadFonts />
    <title>Blog — Release Notes &amp; Behind‑the‑Scenes</title>
    <meta name="description" content="Release notes, design deep dives, and community stories from the Mythic Apps team." />
    <link rel="stylesheet" href="/global.css" />
    <script is:inline src="https://kit.fontawesome.com/9f0db3cdf4.js" crossorigin="anonymous"></script>
    <link rel="canonical" href="https://jasonholtdigital.com/blog/" />
  </head>
  <body>
    <a class="skip" href="#main">Skip to main content</a>
    <div id="bg-atmo" aria-hidden="true"></div>
    <div id="site">
      <Header />

      <PageHeader 
        title="Release Notes &amp; Behind-the-Scenes"
        subtitle="Updates, insights, and the craft behind the apps"
        description="Plain-language release notes first. Occasional deep dives on design, development, and the players shaping Mythic."
        accent="Blog"
        layout="left"
        icon="fa-solid fa-newspaper"
        colorScheme="secondary"
      />

      <main id="main" class="blog-main">
        {featuredEntry ? (
          <section class="section section--feature" aria-labelledby="feature-title">
            <div class="container">
              <header class="section-head" aria-hidden="true">
                <span class="accent-line" aria-hidden="true"></span>
                <span class="badge-text">Latest</span>
              </header>
              <article class="blog-feature" id="feature">
                <div class="blog-feature__flag" aria-hidden="true">New</div>
                <div class="blog-feature__body">
                  <h2 id="feature-title" class="blog-feature__title">
                    <a href={`/blog/${featuredEntry.slug}/`}>{featuredEntry.data.title}</a>
                  </h2>
                  <p class="blog-feature__summary">{featuredEntry.data.summary}</p>
                  {featuredEntry.data.isSample && (
                    <p class="blog-sample-note">Sample placeholder — replace with the real article before publishing.</p>
                  )}
                  <div class="blog-feature__meta" aria-label="Post details">
                    <span class="blog-pill">{featuredEntry.data.category}</span>
                    <span class="blog-pill">{formatDate(featuredEntry.data.date)}</span>
                    <span class="blog-pill">{featuredEntry.data.readTime}</span>
                    {featuredEntry.data.isSample && <span class="blog-pill blog-pill--sample">Sample</span>}
                  </div>
                  <p class="blog-feature__cta">
                    <a class="blog-feature__link" href={`/blog/${featuredEntry.slug}/`}>
                      Read release notes
                      <i class="fa-slab fa-regular fa-arrow-right" aria-hidden="true"></i>
                    </a>
                  </p>
                </div>
              </article>
            </div>
          </section>
        ) : (
          <section class="section section--feature" aria-labelledby="feature-title">
            <div class="container">
              <header class="section-head" aria-hidden="true">
                <span class="accent-line" aria-hidden="true"></span>
                <span class="badge-text">Latest</span>
              </header>
              <article class="blog-feature" id="feature">
                <div class="blog-feature__body">
                  <h2 id="feature-title" class="blog-feature__title">Blog posts coming soon</h2>
                  <p class="blog-feature__summary">Add markdown files to `src/content/blog/` and rebuild to populate this section.</p>
                </div>
              </article>
            </div>
          </section>
        )}

        <section class="section" aria-labelledby="recent-title">
          <div class="container">
            <header class="section-head" aria-hidden="true">
              <span class="accent-line" aria-hidden="true"></span>
              <span class="badge-text">Blog</span>
            </header>
            <div class="blog-section-heading">
              <h2 id="recent-title" class="section-title">Recent Posts</h2>
              <p class="blog-section-summary">Stay current with Mythic updates, process insights, and community voices.</p>
            </div>
            <ul class="blog-posts" role="list">
              {listEntries.map((entry) => (
                <li>
                  <article class="blog-card">
                    <header class="blog-card__header">
                      <span class="blog-pill">{entry.data.category}</span>
                      <span class="blog-card__date">{formatDate(entry.data.date)}</span>
                    </header>
                    <h3 class="blog-card__title">
                      <a href={`/blog/${entry.slug}/`}>{entry.data.title}</a>
                    </h3>
                    <p class="blog-card__summary">{entry.data.summary}</p>
                    {entry.data.isSample && (
                      <p class="blog-sample-note blog-sample-note--card">Sample placeholder — swap in the real article before launch.</p>
                    )}
                    <footer class="blog-card__footer">
                      <span class="blog-card__readtime">{entry.data.readTime}</span>
                      {entry.data.isSample && (
                        <div class="blog-card__meta">
                          <span class="blog-pill blog-pill--sample">Sample</span>
                        </div>
                      )}
                      <a class="blog-card__link" href={`/blog/${entry.slug}/`}>
                        Read post
                        <i class="fa-slab fa-regular fa-arrow-right" aria-hidden="true"></i>
                      </a>
                    </footer>
                  </article>
                </li>
              ))}
            </ul>
          </div>
        </section>

        <section class="section section-band" id="categories" aria-labelledby="categories-title">
          <div class="container">
            <header class="section-head" aria-hidden="true">
              <span class="accent-line" aria-hidden="true"></span>
              <span class="badge-text">Browse</span>
            </header>
            <div class="blog-section-heading blog-section-heading--center">
              <h2 id="categories-title" class="section-title">Explore by Category</h2>
              <p class="blog-section-summary">Pick a lane to skim updates faster. These anchors map to future tag hubs.</p>
            </div>
            <ul class="blog-categories" role="list">
              {categories.map((category) => (
                <li>
                  <a class="blog-category" href={category.href}>
                    <span class="blog-category__icon" aria-hidden="true">
                      <i class={category.icon}></i>
                    </span>
                    <span class="blog-category__body">
                      <span class="blog-category__name">{category.name}</span>
                      <span class="blog-category__description">{category.description}</span>
                    </span>
                    <span class="blog-category__arrow" aria-hidden="true">
                      <i class="fa-slab fa-regular fa-arrow-right"></i>
                    </span>
                  </a>
                </li>
              ))}
            </ul>
          </div>
        </section>

        <section class="section" id="blog-support" aria-labelledby="blog-support-title">
          <div class="container">
            <header class="section-head" aria-hidden="true">
              <span class="accent-line" aria-hidden="true"></span>
              <span class="badge-text">Stay in touch</span>
            </header>
            <div class="blog-support">
              <div class="blog-support__copy">
                <h2 id="blog-support-title" class="section-title">
                  Keep up with updates
                </h2>
                <p class="blog-support__summary">Hop into Discord or bookmark the resources hub. We post release notes here first, then dive deeper in guides.</p>
              </div>
              <div class="blog-support__actions">
                <a class="btn btn--shadow-discord" href="https://discord.gg/PEDHrhzcnk" target="_blank" rel="noopener">
                  <i class="fa-brands fa-discord" aria-hidden="true"></i>
                  Join Discord
                </a>
                <a class="btn btn--shadow-primary" href="/resources">
                  Browse Guides
                  <i class="fa-slab fa-regular fa-arrow-right" aria-hidden="true"></i>
                </a>
              </div>
            </div>
          </div>
        </section>
      </main>
      <Footer />
    </div>
  </body>
</html>
