---
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import HeadFonts from '../components/HeadFonts.astro';
import PageHeader from '../components/PageHeader.astro';
---
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <HeadFonts />
    <title>Contact — Say Hello | Jason Holt Digital</title>
    <meta name="description" content="Get in touch with Jason Holt for Flutter and cross-platform app development services. Contact via form, email, or join our community Discord." />
    <link rel="stylesheet" href="/global.css" />
    <script src="https://kit.fontawesome.com/9f0db3cdf4.js" crossorigin="anonymous"></script>
    <script is:inline src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
    <link rel="canonical" href="https://jasonholtdigital.com/contact/" />
  </head>
  <body>
    <a class="skip" href="#main">Skip to main content</a>
    <div id="bg-atmo" aria-hidden="true"></div>
    <div id="site">
      <Header />
      
      <PageHeader 
        title="Get in Touch"
        subtitle="Let's start a conversation"
        description="Prefer Support for quick answers. Use the form below for detailed questions or collaboration opportunities."
        accent="Contact"
        layout="left"
        icon="fa-solid fa-envelope"
        visualElement="shapes"
        colorScheme="secondary"
      />
      
      <main id="main" class="container" style="min-height:40vh; padding: 3rem 0;">
        <div class="twoup" style="margin-top: 2rem; gap: 2rem;">
          <!-- Left column: Contact info and quick help -->
          <div>
            <section class="panel" aria-labelledby="fast-help">
              <h2 id="fast-help">Get Help Fast</h2>
              <div style="margin-top: 1rem;">
                <h3>Support &amp; FAQ</h3>
                <p>Short answers to common questions.</p>
                <p><a class="cta-brick" href="/support">Go to Support&nbsp;→</a></p>
              </div>
              <div style="margin-top: 1.5rem;">
                <h3>Discord Community</h3>
                <p>Tips, support, feature requests—say hi!</p>
                <p>
                  <a class="cta-brick" href="https://discord.gg/PEDHrhzcnk" target="_blank" rel="noopener">
                    <i class="fa-brands fa-discord" aria-hidden="true"></i>
                    Join Discord
                  </a>
                </p>
              </div>
            </section>

            <section class="panel" aria-labelledby="email-title" style="margin-top:1rem">
              <h2 id="email-title">Email Contacts</h2>
              <ul style="list-style: none; padding: 0;">
                <li style="margin-bottom: 0.5rem;"><strong>Support:</strong> <a href="mailto:support@jasonholtdigital.com">support@jasonholtdigital.com</a></li>
                <li><strong>General:</strong> <a href="mailto:jason@jasonholtdigital.com">jason@jasonholtdigital.com</a></li>
              </ul>
            </section>

            <section class="panel" aria-labelledby="work-title" style="margin-top:1rem">
              <h2 id="work-title">Work with me</h2>
              <p>For app development projects, hire me on Upwork.</p>
              <p>
                <a class="cta-brick" href="https://www.upwork.com/fl/~01e352937913645264?mp_source=share" target="_blank" rel="noopener">
                  <i class="fa-solid fa-briefcase" aria-hidden="true"></i>
                  Hire me on Upwork
                </a>
              </p>
            </section>
          </div>

          <!-- Right column: Contact form -->
          <div>
            <section class="panel" aria-labelledby="contact-form-title">
              <h2 id="contact-form-title">Send a Message</h2>
              <form id="contact-form" action="https://submit-form.com/BrXEDLTap" method="post" style="margin-top: 1rem;">
                <div style="display: grid; gap: 1rem;">
                  <div>
                    <label for="name" style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Full Name</label>
                    <input type="text" id="name" name="name" required maxlength="256" 
                           style="width: 100%; padding: 12px; border: var(--border-base); background: #fff; font-family: inherit;" 
                           placeholder="Your full name">
                  </div>
                  
                  <div>
                    <label for="email" style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Email Address</label>
                    <input type="email" id="email" name="email" required maxlength="256" 
                           style="width: 100%; padding: 12px; border: var(--border-base); background: #fff; font-family: inherit;" 
                           placeholder="your@email.com">
                  </div>
                  
                  <div>
                    <label for="phone" style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Phone (optional)</label>
                    <input type="tel" id="phone" name="phone" maxlength="256" 
                           style="width: 100%; padding: 12px; border: var(--border-base); background: #fff; font-family: inherit;" 
                           placeholder="Your phone number">
                  </div>
                  
                  <div>
                    <label for="message" style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Message</label>
                    <textarea id="message" name="message" required maxlength="5000" rows="6" 
                              style="width: 100%; padding: 12px; border: var(--border-base); background: #fff; font-family: inherit; resize: vertical;" 
                              placeholder="Tell me about your project or question..."></textarea>
                  </div>
                  
                  <!-- Cloudflare Turnstile -->
                  <div class="cf-turnstile" data-sitekey="0x4AAAAAABhU6Cccio-kREUw" data-callback="onTurnstileSuccess"></div>
                  
                  <div>
                    <button type="submit" id="submit-btn" disabled class="btn btn--primary" style="width: 100%;">
                      <i class="fa-solid fa-paper-plane" aria-hidden="true"></i>
                      Send Message
                    </button>
                  </div>
                </div>
                
                <!-- Success/Error Messages -->
                <div id="form-success" style="display: none; margin-top: 1rem; padding: 1rem; background: #d4edda; border: var(--border-base); color: #155724;">
                  <strong>Thank you!</strong> Your message has been sent successfully. I'll get back to you within 2 business days.
                </div>
                
                <div id="form-error" style="display: none; margin-top: 1rem; padding: 1rem; background: #f8d7da; border: var(--border-base); color: #721c24;">
                  <strong>Oops!</strong> Something went wrong. Please try again or email me directly at jason@jasonholtdigital.com.
                </div>
              </form>
            </section>

            <section class="panel" aria-labelledby="location-title" style="margin-top:1rem">
              <h2 id="location-title">Location</h2>
              <p>Born in Texas, based in Frankfurt. Working with clients worldwide.</p>
              <p style="color: var(--color-text-muted); font-size: 0.9rem;"><small>Thanks for reaching out — I typically reply within 2 business days.</small></p>
            </section>
          </div>
        </div>
      </main>
      <Footer />
    </div>
    
    <script>
      // Turnstile callback function
      function onTurnstileSuccess(token: string) {
        const submitBtn = document.getElementById('submit-btn') as HTMLButtonElement | null;
        if (submitBtn) submitBtn.disabled = false;

        // Add the token to the form as a hidden input
        const form = document.getElementById('contact-form') as HTMLFormElement | null;
        if (!form) return;
        let tokenInput = document.getElementById('cf-turnstile-response') as HTMLInputElement | null;
        if (!tokenInput) {
          tokenInput = document.createElement('input');
          tokenInput.type = 'hidden';
          tokenInput.name = 'cf-turnstile-response';
          tokenInput.id = 'cf-turnstile-response';
          form.appendChild(tokenInput);
        }
        tokenInput.value = token;
      }
      ;(window as any).onTurnstileSuccess = onTurnstileSuccess;

      // Handle form submission
      const formEl = document.getElementById('contact-form') as HTMLFormElement | null;
      formEl?.addEventListener('submit', async (e) => {
        e.preventDefault();
        const form = e.currentTarget as HTMLFormElement;

        const submitBtn = document.getElementById('submit-btn') as HTMLButtonElement | null;
        const turnstileToken = document.getElementById('cf-turnstile-response') as HTMLInputElement | null;
        const successDiv = document.getElementById('form-success') as HTMLElement | null;
        const errorDiv = document.getElementById('form-error') as HTMLElement | null;
        
        // Hide previous messages
        if (successDiv) successDiv.style.display = 'none';
        if (errorDiv) errorDiv.style.display = 'none';
        
        if (!turnstileToken || !turnstileToken.value) {
          alert('Please complete the security verification.');
          return false;
        }
        
        // Show loading state
        const originalText = submitBtn?.innerHTML ?? '';
        if (submitBtn) {
          submitBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin" aria-hidden="true"></i> Sending...';
          submitBtn.disabled = true;
        }
        
        try {
          const formData = new FormData(form);
          const response = await fetch(form.action, {
            method: 'POST',
            body: formData
          });
          
          if (response.ok) {
            // Success
            if (successDiv) successDiv.style.display = 'block';
            form.reset();
            // Reset Turnstile
            (window as any).turnstile?.reset();
          } else {
            // Error
            if (errorDiv) errorDiv.style.display = 'block';
          }
        } catch (error) {
          console.error('Form submission error:', error);
          if (errorDiv) errorDiv.style.display = 'block';
        } finally {
          // Reset button
          if (submitBtn) {
            submitBtn.innerHTML = originalText;
            submitBtn.disabled = true; // Disabled until Turnstile is completed again
          }
        }
      });
    </script>
  </body>
</html>
